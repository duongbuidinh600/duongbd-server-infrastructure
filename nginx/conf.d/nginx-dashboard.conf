server {
    listen 80;
    server_name nginx.duongbd.site;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name nginx.duongbd.site;

    # SSL configuration
    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;

    # Basic authentication for dashboard
    auth_basic "Nginx Dashboard";
    auth_basic_user_file /etc/nginx/.htpasswd-admin;

    # Rate limiting
    limit_req zone=general burst=10 nodelay;

    # Nginx status page
    location /nginx-status {
        stub_status on;
        access_log off;
        allow all;
    }

    # Health check endpoint
    location /nginx-health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }

    # Basic dashboard
    location / {
        return 200 '<!DOCTYPE html>
<html>
<head>
    <title>Nginx Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .service { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .service h3 { margin: 0 0 10px 0; color: #333; }
        .service a { color: #007cba; text-decoration: none; }
        .service a:hover { text-decoration: underline; }
        .status { background: #f8f9fa; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Nginx Reverse Proxy Dashboard</h1>
        <div class="status">
            <strong>Proxy Status:</strong> <a href="/nginx-health">Health Check</a> |
            <a href="/nginx-status">Status Page</a>
        </div>

        <h2>Available Services</h2>

        <div class="service">
            <h3>Kafka UI</h3>
            <p><a href="https://kafka.duongbd.site" target="_blank">https://kafka.duongbd.site</a></p>
        </div>

        <div class="service">
            <h3>Redis Commander</h3>
            <p><a href="https://redis.duongbd.site" target="_blank">https://redis.duongbd.site</a></p>
        </div>

        <div class="service">
            <h3>MySQL Adminer</h3>
            <p><a href="https://mysql.duongbd.site" target="_blank">https://mysql.duongbd.site</a></p>
        </div>

        <div class="service">
            <h3>Elasticsearch</h3>
            <p><a href="https://es.duongbd.site" target="_blank">https://es.duongbd.site</a></p>
        </div>

        <div class="service">
            <h3>Kibana</h3>
            <p><a href="https://kibana.duongbd.site" target="_blank">https://kibana.duongbd.site</a></p>
        </div>

        <div class="service">
            <h3>Nexus Repository</h3>
            <p><a href="https://nexus.duongbd.site" target="_blank">https://nexus.duongbd.site</a></p>
        </div>
    </div>
</body>
</html>';
        add_header Content-Type text/html;
    }
}